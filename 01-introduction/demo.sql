-- ============================================================================
-- ПАРА 1: Введение в SQL и подготовка к работе
-- Демонстрационный скрипт
-- ============================================================================

-- ============================================================================
-- ЧАСТЬ 1: Проверка подключения
-- ============================================================================

-- Самый простой запрос - проверка работы
SELECT 1;

-- Если видим результат - подключение работает!

-- ============================================================================
-- ЧАСТЬ 2: PostgreSQL как калькулятор
-- ============================================================================

-- Базовая арифметика
SELECT 2 + 2;           -- сложение
SELECT 10 - 3;          -- вычитание
SELECT 5 * 7;           -- умножение
SELECT 100 / 3;         -- целочисленное деление
SELECT 100.0 / 3;       -- деление с дробной частью
SELECT 17 % 5;          -- остаток от деления (модуль)

-- Возведение в степень и корни
SELECT 2 ^ 10;          -- 2 в степени 10 = 1024
SELECT |/ 144;          -- квадратный корень = 12
SELECT ||/ 27;          -- кубический корень = 3

-- Можно комбинировать операции
SELECT (10 + 5) * 2;
SELECT 2 ^ 8 - 1;       -- максимальное значение для 8 бит

-- ============================================================================
-- ЧАСТЬ 3: Встроенные функции
-- ============================================================================

-- Текущая дата и время
SELECT now();                    -- timestamp с часовым поясом
SELECT current_timestamp;        -- то же самое
SELECT current_date;             -- только дата
SELECT current_time;             -- только время

-- Информация о системе
SELECT current_user;             -- текущий пользователь
SELECT current_database();       -- текущая база данных
SELECT version();                -- версия PostgreSQL

-- ============================================================================
-- ЧАСТЬ 4: Знакомство с демо-БД (мета-команды psql)
-- ============================================================================

-- Выполните в psql:
-- \l                  -- список всех баз данных
-- \c demo             -- подключиться к базе demo
-- \dn                 -- список схем
-- \dt                 -- список таблиц
-- \dt bookings.*      -- таблицы в схеме bookings

-- ============================================================================
-- ЧАСТЬ 5: Просмотр структуры таблиц
-- ============================================================================

-- В psql можно использовать:
-- \d flights          -- структура таблицы flights
-- \d+ flights         -- подробная структура с комментариями

-- Через SQL (работает в любом клиенте):
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'bookings'
  AND table_name = 'flights'
ORDER BY ordinal_position;

-- Список всех таблиц в схеме bookings
SELECT table_name
FROM information_schema.tables
WHERE table_schema = 'bookings'
ORDER BY table_name;

-- ============================================================================
-- ЧАСТЬ 6: Первый взгляд на данные
-- ============================================================================

-- Посмотрим на аэропорты
SELECT * FROM airports_data LIMIT 10;

-- Сколько всего аэропортов?
SELECT count(*) FROM airports_data;

-- Посмотрим на самолёты
SELECT * FROM airplanes_data;

-- Сколько всего моделей самолётов?
SELECT count(*) FROM airplanes_data;

-- Посмотрим на рейсы
SELECT * FROM flights LIMIT 5;

-- Сколько всего рейсов?
SELECT count(*) FROM flights;

-- Посмотрим на бронирования
SELECT * FROM bookings LIMIT 5;

-- Сколько всего бронирований?
SELECT count(*) FROM bookings;

-- ============================================================================
-- ЧАСТЬ 7: Обзор структуры демо-БД
-- ============================================================================

-- Количество записей в каждой таблице
SELECT 'airports_data' AS table_name, count(*) AS row_count FROM airports_data
UNION ALL
SELECT 'airplanes_data', count(*) FROM airplanes_data
UNION ALL
SELECT 'flights', count(*) FROM flights
UNION ALL
SELECT 'bookings', count(*) FROM bookings
UNION ALL
SELECT 'tickets', count(*) FROM tickets
UNION ALL
SELECT 'seats', count(*) FROM seats
UNION ALL
SELECT 'boarding_passes', count(*) FROM boarding_passes;

-- ============================================================================
-- ЧАСТЬ 8: Представления (views) в демо-БД
-- ============================================================================

-- В демо-БД есть удобные представления с русскими названиями
-- Они автоматически извлекают данные на нужном языке

-- Аэропорты (представление)
SELECT * FROM airports LIMIT 5;

-- Самолёты (представление)
SELECT * FROM airplanes;

-- ============================================================================
-- ПРАКТИЧЕСКИЕ ЗАДАНИЯ
-- ============================================================================

-- Задание 1: Выполните SELECT 1; и убедитесь, что подключение работает

-- Задание 2: Вычислите с помощью PostgreSQL:
--   a) 15% от 250
--   b) 2 в степени 16
--   c) Квадратный корень из 625

-- Задание 3: Посмотрите структуру таблицы tickets (\d+ tickets)

-- Задание 4: Сколько строк в таблице boarding_passes?

-- Задание 5: Выведите все столбцы из таблицы seats (LIMIT 10)

-- ============================================================================
-- ОТВЕТЫ НА ЗАДАНИЯ
-- ============================================================================

-- Задание 2a: 15% от 250
SELECT 250 * 0.15;
-- или
SELECT 250 * 15 / 100.0;

-- Задание 2b: 2 в степени 16
SELECT 2 ^ 16;

-- Задание 2c: Квадратный корень из 625
SELECT |/ 625;
-- или
SELECT sqrt(625);

-- Задание 4: Количество строк в boarding_passes
SELECT count(*) FROM boarding_passes;

-- Задание 5: Данные из таблицы seats
SELECT * FROM seats LIMIT 10;
